<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Quiz Time</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
body,html{margin:0;padding:0;overflow:hidden;font-family:'Press Start 2P',monospace;}
canvas{position:absolute;top:0;left:0;z-index:0;display:block;}
#overlay{
  position:absolute;top:0;left:0;width:100%;height:100%;
  display:flex;flex-direction:column;align-items:center;justify-content:flex-start;
  color:#0ff; z-index:1; pointer-events:none;
}
h1{margin:20px;text-shadow:0 0 10px #0ff;}
button{
  padding:10px 20px;font-size:14px;margin:10px;border-radius:8px;cursor:pointer;border:2px solid #0ff;pointer-events:auto;
}
#start-btn,#restart-btn{background-color:#ff0;color:#000;}
#start-btn:hover,#restart-btn:hover{background-color:#0ff;color:#000;}
#import-btn{background-color:#f0f;color:#000;}
#import-btn:hover{background-color:#0ff;color:#000;}
#game{display:flex;justify-content:center;margin-top:20px;display:none;pointer-events:auto;}
#board{display:grid;grid-template-columns:repeat(6,90px);gap:10px;margin-right:30px;}
.box{width:90px;height:90px;background:#111;border:2px solid #0ff;border-radius:8px;
display:flex;align-items:center;justify-content:center;font-size:16px;cursor:pointer;color:#0ff;text-shadow:0 0 5px #0ff;transition:all 0.3s;}
.box:hover{background:#0ff;color:#000;transform:scale(1.1);}
.box.opened{background:#f00;color:#fff;border-color:#f00;cursor:not-allowed;}
#question-area{margin-top:20px;pointer-events:auto;text-align:center;}
.option{display:block;background:#111;color:#0ff;text-shadow:0 0 5px #0ff;margin:5px auto;padding:10px;width:220px;border-radius:8px;cursor:pointer;border:2px solid #0ff;transition:all 0.3s;}
.option:hover{background:#0ff;color:#000;text-shadow:none;}
#scores{text-align:left;background: rgba(0,0,0,0.5);padding:10px;border-radius:10px;color:#0ff;border:2px solid #0ff;pointer-events:auto;}
.winner{font-size:16px;font-weight:bold;margin-top:20px;color:#ff0;text-shadow:0 0 10px #ff0;}
#timer{font-size:14px;font-weight:bold;margin-top:10px;color:#ff0;text-shadow:0 0 5px #ff0;}
</style>
</head>
<body>
<canvas id="cityCanvas"></canvas>
<div id="overlay">
  <h1>üéÆ Quiz Time üéÆ</h1>
  <div id="start-page">
    <button id="import-btn">IMPORT SOAL</button>
    <label for="time-select">Waktu per soal:</label>
    <select id="time-select">
      <option value="5">5 detik</option>
      <option value="10">10 detik</option>
    </select>
    <button id="start-btn">MULAI</button>
  </div>
  <div id="game">
    <div id="board"></div>
    <div id="scores">
      <h2>SKOR</h2>
      <p>Grup 1: <span id="score1">0</span></p>
      <p>Grup 2: <span id="score2">0</span></p>
      <p>Grup 3: <span id="score3">0</span></p>
      <p>Giliran: <span id="turn">Grup 1</span></p>
      <p id="timer"></p>
    </div>
  </div>
  <div id="question-area"></div>
  <div id="winner"></div>
  <button id="restart-btn" style="display:none;">MULAI LAGI</button>
</div>

<script>
// ===== CANVAS & BACKGROUND =====
const canvas=document.getElementById('cityCanvas');
const ctx=canvas.getContext('2d');
canvas.width=window.innerWidth; canvas.height=window.innerHeight;

// Gedung
const buildings=[];
for(let i=0;i<50;i++){
  buildings.push({x:Math.random()*canvas.width,width:30+Math.random()*50,height:100+Math.random()*300,color:'#111',lights:Array.from({length:Math.floor((100+Math.random()*300)/20)},()=>Math.random()<0.5)});
}

// UFO & F16
const ufos=[]; const f16s=[];
for(let i=0;i<3;i++){
  ufos.push({x:Math.random()*canvas.width,y:50+Math.random()*100,speed:1+Math.random()*2,exploding:false,explodeTimer:0});
  f16s.push({x:ufos[i].x-200,y:ufos[i].y+30,speed:2,exploding:false,explodeTimer:0});
}

// Partikel ledakan
const explosions=[];
function createExplosion(x,y,color){
  for(let i=0;i<20;i++){
    explosions.push({
      x:x, y:y,
      vx:(Math.random()-0.5)*4,
      vy:(Math.random()-0.5)*4,
      alpha:1,
      color:color
    });
  }
}
function drawExplosions(){
  for(let i=explosions.length-1;i>=0;i--){
    const p=explosions[i];
    ctx.fillStyle=`rgba(${p.color},${p.alpha})`;
    ctx.beginPath(); ctx.arc(p.x,p.y,3,0,Math.PI*2); ctx.fill();
    p.x+=p.vx; p.y+=p.vy; p.alpha-=0.03;
    if(p.alpha<=0) explosions.splice(i,1);
  }
}

// Draw background
function drawBackground(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const grad=ctx.createLinearGradient(0,0,0,canvas.height);
  grad.addColorStop(0,'#000015'); grad.addColorStop(1,'#0b001f');
  ctx.fillStyle=grad; ctx.fillRect(0,0,canvas.width,canvas.height);

  // Gedung
  buildings.forEach(b=>{
    ctx.fillStyle='#222'; ctx.fillRect(b.x,canvas.height-b.height,b.width,b.height);
    b.lights.forEach((on,i)=>{ if(Math.random()<0.05)b.lights[i]=!b.lights[i];
      ctx.fillStyle=b.lights[i]?'hsl(60,100%,70%)':'#111';
      ctx.fillRect(b.x+5,canvas.height-b.height+i*20+5,5,10);
    });
    b.x-=0.5; if(b.x+b.width<0){b.x=canvas.width+Math.random()*100;b.height=100+Math.random()*300;b.lights=Array.from({length: Math.floor(b.height/20)},()=>Math.random()<0.5);}
  });

  // UFO
  ufos.forEach(u=>{
    if(u.exploding){ u.explodeTimer++; if(u.explodeTimer>0) createExplosion(u.x,u.y,"0,255,0"); u.exploding=false; u.explodeTimer=0; u.x=-50; u.y=50+Math.random()*100; }
    else{ ctx.fillStyle='lime'; ctx.beginPath(); ctx.ellipse(u.x,u.y,20,10,0,0,Math.PI*2); ctx.fill();
      ctx.fillStyle='green'; ctx.fillRect(u.x-10,u.y-3,20,6); u.x+=u.speed; if(u.x>canvas.width+50) u.x=-50; }
  });

  // F16
  f16s.forEach((f,i)=>{
    if(f.exploding){ f.explodeTimer++; if(f.explodeTimer>0) createExplosion(f.x,f.y,"255,0,0"); f.exploding=false; f.explodeTimer=0; f.x=-200; f.y=50+Math.random()*100; }
    else{ const target=ufos[i]; const dx=target.x-f.x; const dy=target.y-f.y; const angle=Math.atan2(dy,dx); f.x+=Math.cos(angle)*f.speed; f.y+=Math.sin(angle)*f.speed;
      ctx.save(); ctx.translate(f.x,f.y); ctx.rotate(angle); ctx.fillStyle='red'; ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(-10,5); ctx.lineTo(-10,-5); ctx.closePath(); ctx.fill(); ctx.restore();
    }
  });

  drawExplosions();
  requestAnimationFrame(drawBackground);
}
drawBackground();
window.addEventListener('resize',()=>{ canvas.width=window.innerWidth; canvas.height=window.innerHeight; });

// ===== GAME QUIZ =====
let originalQuestions=[
  {"q":"2 √ó 2 = ?","options":["2","4","6"],"answer":"4"},
  {"q":"2 √ó 3 = ?","options":["5","6","8"],"answer":"6"},
  {"q":"2 √ó 4 = ?","options":["6","8","10"],"answer":"8"},
  {"q":"2 √ó 5 = ?","options":["8","10","12"],"answer":"10"},
  {"q":"3 √ó 2 = ?","options":["5","6","7"],"answer":"6"},
  {"q":"3 √ó 3 = ?","options":["8","9","12"],"answer":"9"},
  {"q":"3 √ó 4 = ?","options":["10","12","14"],"answer":"12"},
  {"q":"3 √ó 5 = ?","options":["12","15","18"],"answer":"15"},
  {"q":"4 √ó 2 = ?","options":["6","8","10"],"answer":"8"},
  {"q":"4 √ó 3 = ?","options":["10","12","14"],"answer":"12"},
  {"q":"5 √ó 2 = ?","options":["8","10","12"],"answer":"10"},
  {"q":"5 √ó 3 = ?","options":["12","15","18"],"answer":"15"},
  {"q":"5 √ó 4 = ?","options":["18","20","22"],"answer":"20"},
  {"q":"2 √ó 6 = ?","options":["10","12","14"],"answer":"12"},
  {"q":"3 √ó 6 = ?","options":["16","18","20"],"answer":"18"},
  {"q":"4 √ó 4 = ?","options":["14","16","18"],"answer":"16"},
  {"q":"5 √ó 5 = ?","options":["20","25","30"],"answer":"25"},
  {"q":"2 √ó 9 = ?","options":["16","18","20"],"answer":"18"}
];

let questions=[], scores=[0,0,0], turn=0, used=[], countdown, timePerQuestion=5, timeLeft=5;

const startPage=document.getElementById("start-page");
const importBtn=document.getElementById("import-btn");
const startBtn=document.getElementById("start-btn");
const restartBtn=document.getElementById("restart-btn");
const board=document.getElementById("board");
const questionArea=document.getElementById("question-area");
const winnerDiv=document.getElementById("winner");
const timerEl=document.getElementById("timer");
const timeSelect=document.getElementById("time-select");

// Import soal JSON
importBtn.addEventListener("click", ()=>{
  const fileInput=document.createElement('input'); fileInput.type='file'; fileInput.accept='.json';
  fileInput.onchange=e=>{ const file=e.target.files[0]; const reader=new FileReader();
    reader.onload=event=>{ try{ originalQuestions=JSON.parse(event.target.result); alert("‚úÖ Soal berhasil diimport!"); }catch{ alert("‚ùå Format salah!");} };
    reader.readAsText(file);
  };
  fileInput.click();
});

// Pilih waktu
timeSelect.addEventListener("change",()=>{ timePerQuestion=parseInt(timeSelect.value); });

// Mulai game
startBtn.addEventListener("click", ()=>{
  startGame();
  timeSelect.disabled=true; // lock waktu saat game
});
restartBtn.addEventListener("click",()=>{
  startPage.style.display="flex"; document.getElementById("game").style.display="none"; winnerDiv.innerHTML="";
  timeSelect.disabled=false; // bisa pilih lagi
});

// ===== FUNGSI GAME =====
function shuffle(array){ let arr=array.slice(); for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }

function startGame(){
  startPage.style.display="none"; document.getElementById("game").style.display="flex"; restartBtn.style.display="none"; winnerDiv.innerHTML="";
  scores=[0,0,0]; turn=0; used=Array(originalQuestions.length).fill(false);
  document.getElementById("score1").textContent=0; document.getElementById("score2").textContent=0; document.getElementById("score3").textContent=0;
  document.getElementById("turn").textContent="Grup 1"; questionArea.innerHTML=""; board.innerHTML=""; timerEl.textContent="";
  questions=shuffle(originalQuestions); createBoard();
}

function createBoard(){
  questions.forEach((q,i)=>{ const box=document.createElement("div"); box.classList.add("box"); box.textContent=i+1; box.addEventListener("click",()=>selectBox(i,box)); board.appendChild(box); });
}

function selectBox(i, box){ if(used[i]) return; used[i]=true; box.classList.add("opened"); showQuestion(i); startTimer(i); }

function showQuestion(i){
  clearInterval(countdown); timeLeft=timePerQuestion; timerEl.textContent=`Waktu: ${timeLeft} detik`;
  const q=questions[i]; questionArea.innerHTML=`<h2>${q.q}</h2>`;
  q.options.forEach(opt=>{
    const btn=document.createElement("div");
    btn.classList.add("option"); btn.textContent=opt;
    btn.onclick=()=>checkAnswer(opt,q.answer);
    questionArea.appendChild(btn);
  });
}

function startTimer(i){
  clearInterval(countdown); timeLeft=timePerQuestion; timerEl.textContent=`Waktu: ${timeLeft} detik`;
  countdown=setInterval(()=>{
    timeLeft--; timerEl.textContent=`Waktu: ${timeLeft} detik`;
    if(timeLeft<=0){ clearInterval(countdown); alert("‚è∞ Waktu habis! Jawaban dianggap salah."); questionArea.innerHTML=""; nextTurn(); checkWinner(); }
  },1000);
}

function checkAnswer(opt, ans){
  clearInterval(countdown);
  const ufoIndex=turn % ufos.length;
  if(opt===ans){
    scores[turn]+=10;
    alert("‚úÖ Benar! +10 poin");
    ufos[ufoIndex].exploding=true;
    createExplosion(ufos[ufoIndex].x, ufos[ufoIndex].y,"0,255,0"); // ledakan UFO hijau
  } else {
    alert("‚ùå Salah!");
    f16s[ufoIndex].exploding=true;
    createExplosion(f16s[ufoIndex].x, f16s[ufoIndex].y,"255,0,0"); // ledakan F16 merah
  }
  updateScores(); questionArea.innerHTML=""; nextTurn(); checkWinner();
}

function updateScores(){
  document.getElementById("score1").textContent=scores[0];
  document.getElementById("score2").textContent=scores[1];
  document.getElementById("score3").textContent=scores[2];
}

function nextTurn(){ turn=(turn+1)%3; document.getElementById("turn").textContent="Grup "+(turn+1); }

function checkWinner(){
  if(used.every(u=>u)){ const maxScore=Math.max(...scores); const winner=scores.indexOf(maxScore)+1;
    winnerDiv.innerHTML=`<div class="winner">üèÜ Pemenang: Grup ${winner} dengan ${maxScore} poin üéâ</div>`; restartBtn.style.display="inline-block";
  }
}
</script>
</body>
</html>
